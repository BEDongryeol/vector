sources:
  csp-web:
    type: file
    include:
      - /test/var/log/csp-was.log
    fingerprinting:
      strategy: checksum
    line_delimiter: "\n"
    multiline:
      condition_pattern: '^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}'
      start_pattern: '^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}'
      mode: halt_before
      timeout_ms: 10
    encoding:
      charset: utf-8

transforms:
  parse_log:
    type: remap
    inputs:
      - csp-web
    source: |
      .platform = "csp-web"
      .parsed, err = parse_regex(.message, r'^(?P<timestamp>\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}) (?P<level>\w+) - (?P<message>.+)$')
      if err != null {
        log("Error parsing log message: " + err, level: "error")
      } else {
        .timestamp = parse_timestamp!(.parsed.timestamp, "%Y-%m-%d %H:%M:%S")
        .level = .parsed.level
        .message = .parsed.message
      }

sinks:
  out:
    type: console
    inputs:
      - parse_log
    encoding:
      codec: json

